<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruta de Identidad - Juego Interactivo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tipograf√≠as elegantes -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Lato:wght@300;400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-raices: radial-gradient(circle at top, #020617 0, #020617 55%, #000000 100%);
      --bg-restauracion: radial-gradient(circle at top, #312e81 0, #111827 55%, #020617 100%);
      --bg-fruto: radial-gradient(circle at top, #14532d 0, #052e16 55%, #020617 100%);

      --accent: #e0b95b;
      --accent-soft: rgba(224, 185, 91, 0.18);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.35);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Lato", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: var(--bg-raices);
      transition: background 0.6s ease;
    }

    body.etapa-raices {
      background: var(--bg-raices);
    }

    body.etapa-restauracion {
      background: var(--bg-restauracion);
    }

    body.etapa-fruto {
      background: var(--bg-fruto);
    }

    .app-container {
      max-width: 1000px;
      width: 100%;
      background: linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,1));
      border-radius: 32px;
      padding: 26px 20px 22px;
      box-shadow:
        0 30px 80px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(148, 163, 184, 0.24);
      border: 1px solid rgba(148, 163, 184, 0.3);
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .app-container {
        padding: 30px 32px 26px;
      }
    }

    .glow-orb {
      position: absolute;
      width: 260px;
      height: 260px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(224, 185, 91, 0.28), transparent 60%);
      top: -90px;
      right: -60px;
      pointer-events: none;
      filter: blur(1px);
    }

    .header {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 18px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .app-title {
      font-family: "Playfair Display", serif;
      font-size: 1.8rem;
      letter-spacing: 0.03em;
    }

    .badge {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      padding: 3px 10px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      font-size: 0.75rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.09em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 8px rgba(224, 185, 91, 0.85);
    }

    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .icon-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      padding: 6px 10px;
      font-size: 0.8rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.18s ease, border-color 0.18s ease, transform 0.12s ease;
    }

    .icon-button span:first-child {
      font-size: 1rem;
    }

    .icon-button:hover {
      background: rgba(15, 23, 42, 1);
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .app-subtitle {
      font-size: 0.9rem;
      color: var(--text-muted);
      max-width: 520px;
      margin-top: 4px;
    }

    .progress-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 12px;
      font-size: 0.84rem;
      color: var(--text-muted);
    }

    .progress-bar-wrapper {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      overflow: hidden;
      border: 1px solid rgba(30, 64, 175, 0.6);
    }

    .progress-bar-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, var(--accent), #fbbf24);
      transition: width 0.35s ease;
    }

    .stage-indicator {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--accent);
    }

    .score-indicator {
      font-size: 0.84rem;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1fr);
      gap: 20px;
      align-items: stretch;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      position: relative;
      border-radius: 24px;
      padding: 18px 16px 16px;
      background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.16), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(148, 163, 184, 0.35);
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .card {
        padding: 22px 22px 18px;
      }
    }

    .card-title {
      font-size: 0.86rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .question-text {
      font-family: "Playfair Display", serif;
      font-size: 1.06rem;
      margin-bottom: 14px;
      line-height: 1.45;
    }

    .mini-case {
      font-size: 0.86rem;
      color: var(--text-muted);
      margin-bottom: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.7);
    }

    .options-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 6px;
    }

    .option {
      position: relative;
      border-radius: 16px;
      padding: 12px 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.78);
      cursor: pointer;
      display: flex;
      gap: 10px;
      align-items: flex-start;
      transition:
        background 0.18s ease,
        border-color 0.18s ease,
        transform 0.12s ease,
        box-shadow 0.18s ease;
      transform-style: preserve-3d;
    }

    .option.disabled {
      pointer-events: none;
      opacity: 0.7;
    }

    .option:hover {
      background: rgba(15, 23, 42, 0.98);
      border-color: var(--accent-soft);
      transform: translateY(-1px) perspective(700px) rotateX(2deg);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 1);
    }

    .option.selected {
      border-color: var(--accent);
      background: radial-gradient(circle at top left, rgba(224, 185, 91, 0.16), rgba(15, 23, 42, 0.98));
      box-shadow: 0 0 0 1px rgba(224, 185, 91, 0.2), 0 16px 32px rgba(15, 23, 42, 1);
      transform: translateY(-1px) perspective(700px) rotateX(2deg);
    }

    .option-indicator {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 2px;
      flex-shrink: 0;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .option.selected .option-indicator {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .option-content {
      font-size: 0.94rem;
      line-height: 1.4;
    }

    .footer-row {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .primary-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 8px 14px;
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background 0.18s ease, border-color 0.18s ease, transform 0.12s ease;
    }

    .primary-button:hover {
      background: rgba(15, 23, 42, 1);
      border-color: var(--accent);
      transform: translateY(-0.5px);
    }

    .timer {
      font-size: 0.86rem;
      color: var(--accent);
    }

    .tree-card {
      border-radius: 24px;
      padding: 16px 14px;
      background: radial-gradient(circle at top right, rgba(34, 197, 94, 0.16), rgba(15, 23, 42, 0.96));
      border: 1px solid rgba(55, 141, 102, 0.6);
      display: flex;
      flex-direction: column;
      gap: 10px;
      justify-content: space-between;
    }

    .tree-title {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: #bbf7d0;
    }

    .tree-visual {
      font-size: 2.4rem;
      text-align: center;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .tree-stage-text {
      font-size: 0.86rem;
      text-align: center;
      color: var(--text-muted);
    }

    .tree-description {
      font-size: 0.82rem;
      line-height: 1.4;
      color: var(--text-muted);
    }

    .badge-final {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 6px 12px;
      font-size: 0.82rem;
      background: rgba(15, 23, 42, 0.95);
    }

    .badge-final span:first-child {
      font-size: 1.1rem;
    }

    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }

    .bounce-once {
      animation: bounceOnce 0.25s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes bounceOnce {
      0% { transform: translateY(0); }
      35% { transform: translateY(-3px); }
      70% { transform: translateY(1px); }
      100% { transform: translateY(0); }
    }

    /* Intro styles */
    .intro-title {
      font-family: "Playfair Display", serif;
      font-size: 1.4rem;
      margin-bottom: 10px;
    }

    .intro-text {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 14px;
      line-height: 1.5;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
    }

    .field-label {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .field-input {
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: #020617;
      color: var(--text-main);
      font-size: 0.9rem;
    }

    .mode-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .mode-button {
      flex: 1;
      min-width: 120px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 8px 10px;
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-main);
      font-size: 0.86rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: background 0.18s ease, border-color 0.18s ease, transform 0.12s ease;
    }

    .mode-button:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .mode-button.selected {
      border-color: var(--accent);
      background: radial-gradient(circle at top left, rgba(224, 185, 91, 0.18), rgba(15, 23, 42, 1));
    }

    .mode-title {
      font-weight: 600;
      font-size: 0.88rem;
    }

    .mode-desc {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .hint-text {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

  </style>
</head>
<body class="etapa-raices">
  <div class="app-container">
    <div class="glow-orb"></div>

    <div class="header">
      <div class="header-top">
        <div class="title-block">
          <div class="badge">
            <span class="badge-dot"></span>
            Ruta de identidad
          </div>
          <h1 class="app-title">El √Årbol de tu Identidad</h1>
        </div>
        <div class="controls">
          <button id="toggle-sound-btn" class="icon-button" type="button">
            <span>üîä</span><span>Sonidos</span>
          </button>
          <button id="toggle-music-btn" class="icon-button" type="button">
            <span>üéµ</span><span>M√∫sica</span>
          </button>
        </div>
      </div>
      <p class="app-subtitle" id="subtitle-text">
        Recorre doce operaciones que exploran tu identidad, tus ra√≠ces, tus muros y tu fruto. Elige con honestidad; las respuestas te mostrar√°n en qu√© punto del proceso est√°s.
      </p>
    </div>

    <div class="progress-row">
      <div class="stage-indicator" id="stage-indicator">Etapa: Ra√≠ces</div>
      <div class="progress-bar-wrapper">
        <div id="progress-bar" class="progress-bar-fill"></div>
      </div>
      <div class="score-indicator">
        Puntos: <span id="score-indicator">0</span>
        <span id="timer-text" class="timer" style="display:none;"> ¬∑ 45s</span>
      </div>
    </div>

    <div class="layout">
      <div id="main-card" class="card fade-in">
        <!-- Contenido din√°mico -->
      </div>

      <div class="tree-card" id="tree-card">
        <div class="tree-title">√Årbol de tu proceso</div>
        <div class="tree-visual" id="tree-visual">üå±</div>
        <div class="tree-stage-text" id="tree-stage-text">Semilla ¬∑ El comienzo de la conciencia</div>
        <div class="tree-description" id="tree-description">
          A medida que avanzas, tu √°rbol pasar√° de semilla a fruto. Cada decisi√≥n es un peque√±o gesto de apertura al proceso.
        </div>
      </div>
    </div>
  </div>

  <!-- Sonidos (pon tu propia ruta en src cuando tengas los audios) -->
  <audio id="click-sound" src="musica2.mp3"></audio>

  <audio id="bg-music" src="musica1.mp3" loop></audio>

  <script>
    // =====================
    // DATOS DEL JUEGO
    // =====================
    const operaciones = [
      {
        id: 1,
        titulo: "Operaci√≥n 1 ¬∑ √Årbol de la Vida",
        subtitulo: "Tu identidad define tu fruto",
        miniCase: "Imagina que alguien se da cuenta de que todo lo que hace est√° muy enfocado en c√≥mo lo ven los dem√°s.",
        pregunta:
          "Cuando piensas en tu identidad y en el fruto que est√°s dando hoy, ¬øqu√© sientes que es m√°s importante en este momento?",
        opciones: [
          {
            texto:
              "Profundizar en qui√©n soy realmente y en lo que hay en mi coraz√≥n, aunque eso me confronte y me haga replantear cosas.",
            puntos: 3
          },
          {
            texto:
              "Organizar mejor mi vida y mis logros para que lo que se vea por fuera hable bien de m√≠ y de lo que estoy construyendo.",
            puntos: 2
          },
          {
            texto:
              "No darle tantas vueltas a qui√©n soy; lo importante es ir saliendo adelante con lo que la vida vaya trayendo.",
            puntos: 0
          }
        ]
      },
      {
        id: 2,
        titulo: "Operaci√≥n 2 ¬∑ Diagn√≥stico ‚Äì Mi √Årbol",
        subtitulo: "Eval√∫a tu condici√≥n real",
        miniCase: null,
        pregunta:
          "Si tuvieras que mirar tu ‚Äú√°rbol interior‚Äù (tu car√°cter, tus motivaciones, tus frutos), ¬øc√≥mo preferir√≠as hacerlo?",
        opciones: [
          {
            texto:
              "Con sinceridad, pidiendo luz para ver tanto lo que est√° bien como lo que no est√° alineado y necesita ajuste.",
            puntos: 3
          },
          {
            texto:
              "Enfoc√°ndome en aquello que pueda mejorar mi imagen y mi efectividad, sin detenerme demasiado en lo que me incomoda.",
            puntos: 2
          },
          {
            texto:
              "Solo revisando lo que no me genere demasiada carga; al fin y al cabo, todos tenemos cosas por mejorar y es normal.",
            puntos: 0
          }
        ]
      },
      {
        id: 3,
        titulo: "Operaci√≥n 3 ¬∑ La Semilla",
        subtitulo: "Encuentra el origen de qui√©n eres",
        miniCase: "Piensa en alguien que descubre que su manera de verse a s√≠ mismo viene muy marcada por su historia familiar.",
        pregunta:
          "Al explorar el origen de qui√©n eres, ¬øqu√© enfoque te parece m√°s natural?",
        opciones: [
          {
            texto:
              "Reconocer que hay un dise√±o intencional sobre mi vida y buscar comprender c√≥mo ese origen puede redefinir mi manera de vivir.",
            puntos: 3
          },
          {
            texto:
              "Buscar aquello en mi historia que me haga sentir especial, diferente o con una ‚Äúmarca‚Äù que me destaque de los dem√°s.",
            puntos: 2
          },
          {
            texto:
              "Interpretar mi origen principalmente como una suma de circunstancias familiares y sociales que simplemente me toc√≥ vivir.",
            puntos: 0
          }
        ]
      },
      {
        id: 4,
        titulo: "Operaci√≥n 4 ¬∑ Contaminantes ‚Äì Falsos Profetas",
        subtitulo: "Identifica voces que distorsionan tu identidad",
        miniCase:
          "Imagina a alguien que recuerda frases que le dijeron de ni√±o y que todav√≠a hoy suenan en su cabeza.",
        pregunta:
          "Al pensar en las voces que han influido en tu identidad (comentarios, modelos, mensajes), ¬øc√≥mo prefieres relacionarte con ellas?",
        opciones: [
          {
            texto:
              "Revisando qu√© mensajes he cre√≠do, contrast√°ndolos con la verdad de Dios, y haciendo espacio para que sean corregidos.",
            puntos: 3
          },
          {
            texto:
              "Identificando qu√© dijeron o hicieron otros, principalmente para explicar por qu√© reacciono como reacciono hoy.",
            puntos: 2
          },
          {
            texto:
              "Rest√°ndole importancia a esas voces; lo pasado ya pas√≥ y lo mejor es no remover demasiado esas cosas.",
            puntos: 0
          }
        ]
      },
      {
        id: 5,
        titulo: "Operaci√≥n 5 ¬∑ Muro del Rechazo",
        subtitulo: "Reconoce sus efectos en esp√≠ritu, alma y cuerpo",
        miniCase: null,
        pregunta:
          "Ante las experiencias de rechazo que has vivido, ¬øqu√© actitud describir√≠a mejor c√≥mo sueles manejarlas?",
        opciones: [
          {
            texto:
              "Reconocer que me han marcado m√°s de lo que pensaba y abrirme a procesarlas, aunque sea inc√≥modo.",
            puntos: 3
          },
          {
            texto:
              "Utilizarlas como combustible para demostrar que puedo m√°s, que soy fuerte y que nadie volver√° a herirme as√≠.",
            puntos: 2
          },
          {
            texto:
              "Minimizarlas o hacer como si no me hubieran afectado tanto; hay cosas peores y es mejor seguir adelante sin removerlo.",
            puntos: 0
          }
        ]
      },
      {
        id: 6,
        titulo: "Operaci√≥n 6 ¬∑ Muro de la Rebeld√≠a",
        subtitulo: "Comprende c√≥mo te afecta interiormente",
        miniCase:
          "Imagina que alguien siempre se siente atacado cuando le se√±alan algo que podr√≠a mejorar.",
        pregunta:
          "Cuando alguien te confronta o te invita a cambiar algo profundo en tu vida, ¬øqu√© reacci√≥n sientes m√°s cercana?",
        opciones: [
          {
            texto:
              "Escuchar, aunque me cueste, y tomar tiempo para discernir si hay algo que de verdad necesito rendir o ajustar.",
            puntos: 3
          },
          {
            texto:
              "Aceptar solo lo que no toque demasiado mis decisiones; prefiero mantener el control de c√≥mo y cu√°ndo cambio.",
            puntos: 2
          },
          {
            texto:
              "Pensar que, en general, el problema est√° m√°s en la forma en que los dem√°s me piden las cosas que en lo que yo hago.",
            puntos: 0
          }
        ]
      },
      {
        id: 7,
        titulo: "Operaci√≥n 7 ¬∑ Tierra y Agua ‚Äì La Plomada",
        subtitulo: "Conoce el plan de restauraci√≥n de Dios",
        miniCase: null,
        pregunta:
          "Cuando escuchas que Dios tiene un plan de restauraci√≥n para tu vida, ¬øqu√© enfoque tiendes a tomar?",
        opciones: [
          {
            texto:
              "Quiero entender ese plan, aunque implique reconocer √°reas rotas o desordenadas que necesitan ser reconstruidas.",
            puntos: 3
          },
          {
            texto:
              "Me interesa ese plan principalmente si me ayuda a evitar problemas y a que todo me salga mejor.",
            puntos: 2
          },
          {
            texto:
              "Prefiero pensar que con el tiempo las cosas se ir√°n acomodando solas, sin entrar tanto en procesos de restauraci√≥n.",
            puntos: 0
          }
        ]
      },
      {
        id: 8,
        titulo: "Operaci√≥n 8 ¬∑ La Plomada Divina",
        subtitulo: "Alinea tu vida al dise√±o original",
        miniCase:
          "Piensa en alguien que empieza a notar que muchas de sus decisiones no reflejan lo que dice creer.",
        pregunta:
          "Cuando se habla de ‚Äúalinear tu vida al dise√±o original de Dios‚Äù, ¬øc√≥mo entiendes ese proceso?",
        opciones: [
          {
            texto:
              "Como un camino de ajustes continuos donde Dios va corrigiendo mi manera de pensar, decidir y relacionarme.",
            puntos: 3
          },
          {
            texto:
              "Como un conjunto de principios que puedo aplicar mientras no me obliguen a cambiar cosas que considero parte de mi personalidad.",
            puntos: 2
          },
          {
            texto:
              "Como una idea bonita, pero dif√≠cil de aterrizar; cada uno encuentra su propio equilibrio seg√∫n lo que le funciona.",
            puntos: 0
          }
        ]
      },
      {
        id: 9,
        titulo: "Operaci√≥n 9 ¬∑ Ra√≠ces",
        subtitulo: "Ordena pensamientos y emociones",
        miniCase: null,
        pregunta:
          "Respecto a tus pensamientos y emociones m√°s profundos, ¬øqu√© te parece m√°s cercano a tu forma de manejarlos?",
        opciones: [
          {
            texto:
              "Quiero aprender a ordenarlos, identificando qu√© viene de Dios y qu√© nace del miedo, la herida o la mentira.",
            puntos: 3
          },
          {
            texto:
              "Me interesa dominarlos para que no se noten, de forma que pueda seguir funcionando y cumpliendo con todo.",
            puntos: 2
          },
          {
            texto:
              "Prefiero no profundizar demasiado; sentir y pensar as√≠ es parte de m√≠, y cambiarlo podr√≠a hacerme perder espontaneidad.",
            puntos: 0
          }
        ]
      },
      {
        id: 10,
        titulo: "Operaci√≥n 10 ¬∑ Tallo ‚Äì H√°bitos",
        subtitulo: "Patrones de vida que sostienen tu identidad",
        miniCase:
          "Imagina a alguien que tiene buenas intenciones, pero sus h√°bitos diarios no sostienen lo que desea vivir.",
        pregunta:
          "Al hablar de establecer nuevos h√°bitos que sostengan tu identidad, ¬øqu√© te resuena m√°s?",
        opciones: [
          {
            texto:
              "Construir h√°bitos que, aunque requieran disciplina, me acerquen a Dios y refuercen lo que √âl dice de m√≠.",
            puntos: 3
          },
          {
            texto:
              "Dise√±ar h√°bitos principalmente para ser m√°s productivo y eficiente, y sentir que tengo todo bajo control.",
            puntos: 2
          },
          {
            texto:
              "Confiar en que, mientras tenga buena intenci√≥n, mis h√°bitos actuales son suficientes y no es necesario cambiarlos mucho.",
            puntos: 0
          }
        ]
      },
      {
        id: 11,
        titulo: "Operaci√≥n 11 ¬∑ Prop√≥sito",
        subtitulo: "Descubre el camino preparado para ti",
        miniCase: null,
        pregunta:
          "Cuando piensas en el prop√≥sito de tu vida, ¬øqu√© enfoque sientes m√°s fuerte?",
        opciones: [
          {
            texto:
              "Descubrir qu√© espera Dios de m√≠ y c√≥mo puedo caminar con √âl, aunque eso implique renuncias y decisiones dif√≠ciles.",
            puntos: 3
          },
          {
            texto:
              "Encontrar algo que me haga sentir realizado, visible y con la sensaci√≥n de que he logrado algo significativo.",
            puntos: 2
          },
          {
            texto:
              "Evitar darle demasiada importancia al tema del prop√≥sito; es mejor ir viviendo y ver qu√© oportunidades aparecen.",
            puntos: 0
          }
        ]
      },
      {
        id: 12,
        titulo: "Operaci√≥n 12 ¬∑ El Fruto",
        subtitulo: "Activa una vida que produce fruto sano",
        miniCase:
          "Imagina a alguien que piensa en qu√© quedar√° en la vida de su familia cuando √©l ya no est√©.",
        pregunta:
          "Al pensar en el fruto que quieres dejar en tu vida y en tu familia, ¬øqu√© prioridad se identifica m√°s contigo?",
        opciones: [
          {
            texto:
              "Que lo que salga de mi vida refleje cada vez m√°s el car√°cter de Dios y traiga bienestar real a quienes me rodean.",
            puntos: 3
          },
          {
            texto:
              "Que se vea que he logrado cosas, que he avanzado y que mi esfuerzo ha dado resultados visibles.",
            puntos: 2
          },
          {
            texto:
              "Que las cosas se mantengan estables; mientras no haya grandes problemas, no es tan relevante el tipo de fruto que d√©.",
            puntos: 0
          }
        ]
      }
    ];

    const niveles = [
      {
        min: 32,
        max: 36,
        nombre: "Identidad en maduraci√≥n profunda",
        insignia: { icon: "üíõ", texto: "Coraz√≥n ense√±able" },
        descripcion:
          "Tus respuestas muestran un coraz√≥n dispuesto a mirar adentro con honestidad, dejarse confrontar y alinearse con el dise√±o de Dios. Est√°s en una etapa donde la identidad se est√° consolidando y puedes acompa√±ar a otros, incluso mientras sigues siendo procesado."
      },
      {
        min: 25,
        max: 31,
        nombre: "Identidad en desarrollo activo",
        insignia: { icon: "üåø", texto: "En b√∫squeda activa" },
        descripcion:
          "Reconoces la importancia de tu identidad y est√°s en movimiento hacia la sanidad y la alineaci√≥n con Dios. Todav√≠a hay √°reas donde mezclas control, miedo o autoimagen, pero tu direcci√≥n general es de crecimiento. Con acompa√±amiento y perseverancia, puedes dar pasos clave."
      },
      {
        min: 15,
        max: 24,
        nombre: "Identidad mezclada / motivaciones mixtas",
        insignia: { icon: "üî•", texto: "En despertar" },
        descripcion:
          "Hay deseo de avanzar, pero tus decisiones revelan motivaciones mezcladas: necesidad de aprobaci√≥n, autoexigencia, temor al dolor o a la confrontaci√≥n. Es un territorio muy com√∫n, pero tambi√©n un punto decisivo: abrirte a procesos m√°s profundos puede marcar una diferencia enorme."
      },
      {
        min: 0,
        max: 14,
        nombre: "Identidad estancada / evitativa",
        insignia: { icon: "üåò", texto: "En umbral de despertar" },
        descripcion:
          "Tus respuestas indican que tiendes a minimizar el peso de lo que pasa en tu interior o a dejar los procesos para despu√©s. No es un juicio, sino una fotograf√≠a: probablemente has tenido que protegerte y sobrevivir. Dios no te condena, pero s√≠ te invita a despertar y dejar que √âl trate con tu historia."
      }
    ];

    // =====================
    // ESTADO DEL JUEGO
    // =====================
    let estado = "intro"; // "intro" | "juego" | "resultado"
    let indiceActual = 0;
    let puntajeTotal = 0;
    let nombreJugador = "";
    let modoReto = false;
    let timerId = null;
    let tiempoRestante = 0;
    let sonidoActivo = true;
    let musicaActiva = false;
    let indiceOpcionResaltada = 0;

    // =====================
    // REFERENCIAS DOM
    // =====================
    const mainCardEl = document.getElementById("main-card");
    const progressBarEl = document.getElementById("progress-bar");
    const scoreIndicatorEl = document.getElementById("score-indicator");
    const stageIndicatorEl = document.getElementById("stage-indicator");
    const subtitleTextEl = document.getElementById("subtitle-text");
    const treeVisualEl = document.getElementById("tree-visual");
    const treeStageTextEl = document.getElementById("tree-stage-text");
    const treeDescriptionEl = document.getElementById("tree-description");
    const timerTextEl = document.getElementById("timer-text");
    const toggleSoundBtn = document.getElementById("toggle-sound-btn");
    const toggleMusicBtn = document.getElementById("toggle-music-btn");
    const clickSoundEl = document.getElementById("click-sound");
    clickSoundEl.volume = 0.4; // volumen al 40%

    const bgMusicEl = document.getElementById("bg-music");

    // =====================
    // UTILIDADES
    // =====================
    function actualizarProgresoVisual() {
      const total = operaciones.length;
      if (estado !== "juego") {
        progressBarEl.style.width = "0%";
        return;
      }
      const porcentaje = (indiceActual / total) * 100;
      progressBarEl.style.width = `${porcentaje}%`;
      scoreIndicatorEl.textContent = puntajeTotal;
    }

    function obtenerEtapaPorIndice(indice) {
      if (indice <= 3) return "raices";
      if (indice <= 7) return "restauracion";
      return "fruto";
    }

    function actualizarEtapaVisual() {
      if (estado !== "juego") {
        document.body.className = "etapa-raices";
        stageIndicatorEl.textContent = "Etapa: Ra√≠ces";
        return;
      }
      const etapa = obtenerEtapaPorIndice(indiceActual);
      if (etapa === "raices") {
        document.body.className = "etapa-raices";
        stageIndicatorEl.textContent = "Etapa: Ra√≠ces";
      } else if (etapa === "restauracion") {
        document.body.className = "etapa-restauracion";
        stageIndicatorEl.textContent = "Etapa: Restauraci√≥n";
      } else {
        document.body.className = "etapa-fruto";
        stageIndicatorEl.textContent = "Etapa: Fruto";
      }
    }

    function actualizarArbolVisual() {
      if (estado !== "juego" && estado !== "resultado") {
        treeVisualEl.textContent = "üå±";
        treeStageTextEl.textContent = "Semilla ¬∑ El comienzo de la conciencia";
        treeDescriptionEl.textContent =
          "A medida que avanzas, tu √°rbol pasar√° de semilla a fruto. Cada decisi√≥n es un peque√±o gesto de apertura al proceso.";
        return;
      }

      const i = indiceActual;
      let icon = "üå±";
      let stageText = "Semilla ¬∑ El comienzo de la conciencia";
      let desc =
        "Una peque√±a semilla ha sido plantada: la conciencia de que tu identidad importa y tiene ra√≠ces m√°s profundas de lo que pensabas.";

      if (i >= 2 && i <= 4) {
        icon = "üåø";
        stageText = "Brote ¬∑ Algo nuevo est√° emergiendo";
        desc =
          "Empiezan a asomar brotes nuevos: te est√°s dando cuenta de voces, heridas y patrones que antes pasaban desapercibidos.";
      }
      if (i >= 5 && i <= 7) {
        icon = "üå≥";
        stageText = "Tronco ¬∑ Estructura en formaci√≥n";
        desc =
          "Tu tronco se fortalece a medida que reconoces muros, rebeld√≠as y la necesidad de restauraci√≥n en tu historia.";
      }
      if (i >= 8 && i <= 10) {
        icon = "üå≥üçÉ";
        stageText = "Copa ¬∑ Vida que se expande";
        desc =
          "Las ramas y hojas indican que tu identidad empieza a sostener h√°bitos, pensamientos y emociones m√°s ordenados.";
      }
      if (estado === "resultado" || i >= 11) {
        icon = "üå≥üçé";
        stageText = "Fruto ¬∑ Expresi√≥n visible de tu proceso";
        desc =
          "El fruto habla de una vida que, aun en proceso, empieza a expresar hacia otros lo que Dios ha estado trabajando dentro de ti.";
      }

      treeVisualEl.textContent = icon;
      treeStageTextEl.textContent = stageText;
      treeDescriptionEl.textContent = desc;
    }

    function reproducirClick() {
      if (!sonidoActivo) return;
      if (clickSoundEl && clickSoundEl.play) {
        clickSoundEl.currentTime = 0;
        clickSoundEl.play().catch(() => {});
      }
    }

    function actualizarMusica() {
      if (!bgMusicEl) return;
      if (musicaActiva) {
        bgMusicEl.play().catch(() => {});
      } else {
        bgMusicEl.pause();
      }
    }

    function obtenerNivelPorPuntaje(p) {
      return niveles.find((n) => p >= n.min && p <= n.max) || niveles[niveles.length - 1];
    }

    // =====================
    // PANTALLA DE INTRO
    // =====================
    function mostrarIntro() {
      estado = "intro";
      indiceActual = 0;
      puntajeTotal = 0;
      scoreIndicatorEl.textContent = "0";
      timerTextEl.style.display = "none";
      subtitleTextEl.textContent =
        "Este recorrido no es un examen, es una conversaci√≥n interna con Dios. Responde con honestidad, sin prisa, y deja que el proceso te hable.";
      actualizarProgresoVisual();
      actualizarEtapaVisual();
      actualizarArbolVisual();

      mainCardEl.classList.remove("fade-in");
      void mainCardEl.offsetWidth;
      mainCardEl.classList.add("fade-in");

      mainCardEl.innerHTML = `
        <div class="card-title">Antes de comenzar</div>
        <div class="intro-title">Prepara tu coraz√≥n para la ruta</div>
        <p class="intro-text">
          Este juego te llevar√° por doce operaciones que tocan tu identidad, tus ra√≠ces, tus muros y tu fruto. 
          No hay respuestas ‚Äúcorrectas‚Äù o ‚Äúincorrectas‚Äù; hay honestidad sobre d√≥nde est√°s hoy.
        </p>

        <div class="field-group">
          <label class="field-label" for="nombre-input">¬øC√≥mo te llamas?</label>
          <input id="nombre-input" class="field-input" type="text" placeholder="Escribe tu nombre" />
        </div>

        <div class="field-group">
          <div class="field-label">Elige c√≥mo quieres vivir esta ruta</div>
          <div class="mode-buttons">
            <button type="button" class="mode-button selected" id="modo-tranquilo-btn">
              <div class="mode-title">Modo tranquilo</div>
              <div class="mode-desc">Sin l√≠mite de tiempo. Ideal para pensar y orar mientras respondes.</div>
            </button>
            <button type="button" class="mode-button" id="modo-reto-btn">
              <div class="mode-title">Modo reto</div>
              <div class="mode-desc">Cada pregunta tiene tiempo limitado. Te invita a responder sin sobrepensar.</div>
            </button>
          </div>
        </div>

        <p class="hint-text">
          Puedes usar el mouse o el teclado para responder (1, 2, 3 para las opciones; flechas ‚Üë/‚Üì para moverte; Enter para confirmar).
        </p>

        <div class="footer-row" style="margin-top: 14px;">
          <div class="hint-text">
            T√≥mate un momento para respirar y pedirle a Dios que te hable en el proceso.
          </div>
          <button class="primary-button" type="button" id="start-btn">
            Empezar recorrido
          </button>
        </div>
      `;

      const nombreInput = document.getElementById("nombre-input");
      const modoTranquiloBtn = document.getElementById("modo-tranquilo-btn");
      const modoRetoBtn = document.getElementById("modo-reto-btn");
      const startBtn = document.getElementById("start-btn");

      modoTranquiloBtn.addEventListener("click", () => {
        modoReto = false;
        modoTranquiloBtn.classList.add("selected");
        modoRetoBtn.classList.remove("selected");
      });

      modoRetoBtn.addEventListener("click", () => {
        modoReto = true;
        modoRetoBtn.classList.add("selected");
        modoTranquiloBtn.classList.remove("selected");
      });

      startBtn.addEventListener("click", () => {
        const nombre = (nombreInput.value || "").trim();
        nombreJugador = nombre || "";
        mostrarPrimeraPregunta();
      });
    }

    // =====================
    // PREGUNTAS
    // =====================
    function mostrarPrimeraPregunta() {
      estado = "juego";
      indiceActual = 0;
      puntajeTotal = 0;
      scoreIndicatorEl.textContent = "0";
      subtitleTextEl.textContent = nombreJugador
        ? `${nombreJugador}, responde sin prisa pero con honestidad. Este es un espacio seguro para mirar hacia dentro.`
        : "Responde sin prisa pero con honestidad. Este es un espacio seguro para mirar hacia dentro.";
      mostrarPregunta();
    }

    function iniciarTimer() {
      limpiarTimer();
      if (!modoReto) {
        timerTextEl.style.display = "none";
        return;
      }
      tiempoRestante = 45;
      timerTextEl.style.display = "inline";
      timerTextEl.textContent = ` ¬∑ ${tiempoRestante}s`;
      timerId = setInterval(() => {
        tiempoRestante -= 1;
        if (tiempoRestante < 0) tiempoRestante = 0;
        timerTextEl.textContent = ` ¬∑ ${tiempoRestante}s`;
        if (tiempoRestante <= 0) {
          limpiarTimer();
          avanzarPorTiempo();
        }
      }, 1000);
    }

    function limpiarTimer() {
      if (timerId) {
        clearInterval(timerId);
        timerId = null;
      }
    }

    function mostrarPregunta() {
      if (indiceActual >= operaciones.length) {
        mostrarResultado();
        return;
      }

      const op = operaciones[indiceActual];
      estado = "juego";
      indiceOpcionResaltada = 0;

      actualizarProgresoVisual();
      actualizarEtapaVisual();
      actualizarArbolVisual();
      iniciarTimer();

      mainCardEl.classList.remove("fade-in");
      void mainCardEl.offsetWidth;
      mainCardEl.classList.add("fade-in");

      const saludo = nombreJugador ? `${nombreJugador}, ` : "";

      mainCardEl.innerHTML = `
        <div class="card-title">${op.titulo}</div>
        ${
          op.miniCase
            ? `<div class="mini-case">${op.miniCase}</div>`
            : ""
        }
        <div class="question-text">${saludo}${op.pregunta}</div>
        <ul class="options-list">
          ${op.opciones
            .map((opt, index) => {
              const letra = String.fromCharCode(65 + index);
              const tooltip =
                opt.puntos === 3
                  ? "Esta respuesta refleja apertura y disposici√≥n a un proceso profundo."
                  : opt.puntos === 2
                  ? "Esta respuesta muestra deseo de avanzar, pero con motivaciones mezcladas."
                  : "Esta respuesta puede indicar cierta evasi√≥n o resistencia al proceso.";
              return `
            <li class="option" data-index="${index}" title="${tooltip}">
              <div class="option-indicator">${letra}</div>
              <div class="option-content">${opt.texto}</div>
            </li>
          `;
            })
            .join("")}
        </ul>
        <div class="footer-row">
          <div class="hint-text">
            Usa 1, 2 o 3 para elegir; flechas ‚Üë/‚Üì para moverte; Enter para confirmar.
          </div>
          <button class="primary-button" id="skip-btn" type="button">
            Saltar esta pregunta
          </button>
        </div>
      `;

      const optionEls = mainCardEl.querySelectorAll(".option");
      optionEls.forEach((el) => {
        el.addEventListener("click", () => manejarSeleccion(el));
      });

      const skipBtn = document.getElementById("skip-btn");
      skipBtn.addEventListener("click", () => {
        limpiarTimer();
        indiceActual++;
        mostrarPregunta();
      });

      resaltarOpcionPorIndice();
    }

    function resaltarOpcionPorIndice() {
      const optionEls = mainCardEl.querySelectorAll(".option");
      optionEls.forEach((el, idx) => {
        if (idx === indiceOpcionResaltada) {
          el.classList.add("selected");
        } else {
          el.classList.remove("selected");
        }
      });
    }

    function manejarSeleccion(optionEl) {
      if (estado !== "juego") return;
      limpiarTimer();
      const index = parseInt(optionEl.getAttribute("data-index"), 10);
      const op = operaciones[indiceActual];
      const puntos = op.opciones[index].puntos;

      puntajeTotal += puntos;
      scoreIndicatorEl.textContent = puntajeTotal;
      reproducirClick();

      const optionEls = mainCardEl.querySelectorAll(".option");
      optionEls.forEach((el) => {
        el.classList.add("disabled");
      });
      optionEl.classList.add("bounce-once");

      setTimeout(() => {
        indiceActual++;
        mostrarPregunta();
      }, 380);
    }

    function avanzarPorTiempo() {
      if (estado !== "juego") return;
      indiceActual++;
      mostrarPregunta();
    }

    // =====================
    // RESULTADO
    // =====================
    function mostrarResultado() {
      estado = "resultado";
      limpiarTimer();
      actualizarProgresoVisual();
      actualizarEtapaVisual();
      actualizarArbolVisual();

      const maximo = operaciones.length * 3;
      const nivel = obtenerNivelPorPuntaje(puntajeTotal);
      const nombreNivel = nivel.nombre;
      const descripcionNivel = nivel.descripcion;
      const insignia = nivel.insignia;

      mainCardEl.classList.remove("fade-in");
      void mainCardEl.offsetWidth;
      mainCardEl.classList.add("fade-in");

      document.getElementById("timer-text").style.display = "none";

      mainCardEl.innerHTML = `
        <div class="card-title">Diagn√≥stico de identidad ¬∑ Resumen</div>
        <h2 class="intro-title">Esta es la fotograf√≠a de tu proceso ${
          nombreJugador ? `, ${nombreJugador}` : ""
        }</h2>
        <div class="result-level" style="font-size:0.9rem; text-transform:uppercase; letter-spacing:0.14em; color:${'#e0b95b'}; margin-bottom:8px;">
          ${nombreNivel}
        </div>
        <div class="result-score" style="font-size:0.9rem; margin-bottom:10px; color:${'#9ca3af'};">
          Puntaje obtenido: <strong>${puntajeTotal}</strong> de ${maximo} posibles.
        </div>

        <div class="badge-final">
          <span>${insignia.icon}</span>
          <span>${insignia.texto}</span>
        </div>

        <p class="result-description" style="margin-top:12px;">
          ${descripcionNivel}
        </p>

        <p class="result-note" style="margin-top:10px;">
          Te animo a tomar un tiempo de oraci√≥n o reflexi√≥n con estas preguntas:
          <br><br>
          ¬∑ ¬øQu√© parte de este diagn√≥stico siento que m√°s me describe hoy?<br>
          ¬∑ ¬øQu√© √°rea me duele, pero s√© que necesito entregar a Dios?<br>
          ¬∑ ¬øCon qui√©n podr√≠a caminar este proceso para no hacerlo solo/a?
          <br><br>
          Si est√°s usando este juego en un taller o discipulado, este resultado puede ser una base para una conversaci√≥n m√°s profunda, no para juzgar, sino para acompa√±ar.
        </p>

        <div class="footer-row" style="margin-top: 18px;">
          <button class="primary-button" type="button" id="restart-btn">
            Volver a jugar
          </button>
          <div style="font-size: 0.8rem; color: #9ca3af;">
            Puedes repetir el recorrido en otro momento y ver c√≥mo cambian tus respuestas.
          </div>
        </div>
      `;

      const restartBtn = document.getElementById("restart-btn");
      restartBtn.addEventListener("click", () => {
        mostrarIntro();
      });
    }

    // =====================
    // SONIDO / M√öSICA
    // =====================
    toggleSoundBtn.addEventListener("click", () => {
      sonidoActivo = !sonidoActivo;
      toggleSoundBtn.querySelector("span:first-child").textContent = sonidoActivo ? "üîä" : "üîà";
    });

    toggleMusicBtn.addEventListener("click", () => {
      musicaActiva = !musicaActiva;
      toggleMusicBtn.querySelector("span:first-child").textContent = musicaActiva ? "üéµ" : "üîá";
      actualizarMusica();
    });

    // =====================
    // TECLADO
    // =====================
    document.addEventListener("keydown", (e) => {
      if (estado !== "juego") return;

      const optionEls = mainCardEl.querySelectorAll(".option");
      if (!optionEls.length) return;

      if (e.key === "ArrowDown") {
        e.preventDefault();
        indiceOpcionResaltada = (indiceOpcionResaltada + 1) % optionEls.length;
        resaltarOpcionPorIndice();
      } else if (e.key === "ArrowUp") {
        e.preventDefault();
        indiceOpcionResaltada =
          (indiceOpcionResaltada - 1 + optionEls.length) % optionEls.length;
        resaltarOpcionPorIndice();
      } else if (e.key === "Enter") {
        e.preventDefault();
        const el = optionEls[indiceOpcionResaltada];
        if (el) manejarSeleccion(el);
      } else if (["1", "2", "3"].includes(e.key)) {
        e.preventDefault();
        const idx = parseInt(e.key, 10) - 1;
        const el = optionEls[idx];
        if (el) manejarSeleccion(el);
      }
    });

    // =====================
    // INICIO
    // =====================
    mostrarIntro();
  </script>
</body>
</html>
